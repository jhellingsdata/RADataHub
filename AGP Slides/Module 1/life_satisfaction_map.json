{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "data": {
    "url": "https://raw.githubusercontent.com/jhellingsdata/RADataHub/main/Chart%20Packs/Productivity/map%20of%20the%20day/lad_2021.geojson",
    "format": {"type": "json", "property": "features"}
  },
  "transform": [
    {
      "lookup": "properties.LAD21CD",
      "from": {
        "data": {
          "url": "life_satisfaction.csv"
        },
        "key": "id",
        "fields": ["id", "country", "life_satisfaction"]
      }
    }
  ],
  "projection": {"type": "identity", "reflectY": true},
  "layer": [
    {
      "mark": {
        "type": "geoshape",
        "color": "lightgrey",
        "stroke": "grey",
        "strokeWidth": 0.5,
        "clip": true
      },
      "encoding": {
        "color": {
          "condition": {
            "test": "isValid(datum.life_satisfaction) && datum.life_satisfaction > 0",
            "field": "life_satisfaction",
            "type": "quantitative",
            "legend": {
              "title": "Life satisfaction (out of 10)",
              "titleFontWeight": "normal",
              "labelExpr": "(datum.value == 6.5 ? '<' : datum.value == 8.0 ? '>' : '') + format(datum.value, '.1f')",
              "values": [6.5, 7.0, 7.5, 8.0]
            },
            "scale": {
              "clamp": true,
              "domain": [6.5, 8.0],
              "type": "linear",
              "range": [
                "rgb(235, 61, 75)",
                "rgb(230, 189, 81)",
                "rgb(73, 191, 161)",
                "rgb(111, 181, 219)"
              ]
            }
          },
          "value": "lightgrey"
        },
        "tooltip": [
          {"field": "country", "title": "Local Authority"},
          {"field": "life_satisfaction", "title": "Life satisfaction", "format": ".2f"}
        ]
      }
    }
  ],
  "width": 600,
  "height": 800,
  "config": {"view": {"strokeWidth": 0}, "font": "Circular Std"},
  "autosize": {"type": "fit", "contains": "padding", "resize": false}
}
